<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Scatter plot</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
  </head>

  <body>
    <h1>Scatter Plot by Province</h1>
    <div>
      <select id="provinceSelector">
        <!-- Add an option for selecting all provinces -->
        <option value="All">All Provinces</option>
      </select>

      <a href="website.html"
        ><button class="dv1"><span id="dv1">Home Page</span></button></a
      >
    </div>

    <svg id="scatterplot" style="height: 550px; width: 700px"></svg>

    <script>
      // Load data from CSV
      d3.csv("Tableau_dataset_copy_114.csv").then(function (dataset) {
        // Extract distinct provinces
        var distinctProvinces = Array.from(
          new Set(
            dataset.map(function (d) {
              return d.province;
            })
          )
        );

        // Populate the province selector dropdown
        var provinceSelector = document.getElementById("provinceSelector");
        distinctProvinces.forEach(function (province) {
          var option = document.createElement("option");
          option.value = province;
          option.text = province;
          provinceSelector.appendChild(option);
        });

        // Define margin, width, and height
        var margin = {
          top: 30,
          right: 10,
          bottom: 100,
          left: 30,
        };
        var width = 700 - margin.left - margin.right; // Increase width here
        var height = 500 - margin.top - margin.bottom; // Increase height here

        // Create an SVG element
        var svg = d3
          .select("#scatterplot")
          .append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
          .append("g")
          .attr(
            "transform",
            "translate(" + margin.left + "," + margin.top + ")"
          );
        svg
          .append("text")

          .attr("x", width / 2)
          .attr("y", 465)
          .style("text-anchor", "middle")
          .text("Prices");
        svg
          .append("text")
          .attr("transform", "rotate(-90)")
          .attr("x", -250)
          .attr("y", -22)
          .style("text-anchor", "middle")
          .text("Points");
        // Function to update the scatter plot based on the selected province
        function updateScatterPlot(selectedProvince) {
          var filteredData = dataset;

          if (selectedProvince !== "All") {
            filteredData = dataset.filter(function (d) {
              return d.province === selectedProvince;
            });
          }
          console.log(
            d3.max(filteredData, function (d) {
              return +d.price;
            })
          );
          console.log(
            d3.max(filteredData, function (d) {
              return +d.points;
            })
          );
          // Create scales for x and y axes
          console.log(width);
          console.log(height);
          var xScale = d3
            .scaleLinear()
            .domain([0, 3500])
            //.domain([0, d3.max(filteredData, function(d) { return +d.price; })])
            .range([0, 1000]);

          var yScale = d3
            .scaleLinear()
            //.domain([10, console.log(d3.max(filteredData, function(d) { return +d.points; }))])
            .domain([75, 100])
            .range([450, 0]);

          // Create x and y axes
          var xAxis = d3.axisBottom(xScale);
          var yAxis = d3.axisLeft(yScale);

          // Append the axes to the SVG
          svg.selectAll("g").remove(); // Remove existing axes
          svg
            .append("g")
            .attr("transform", "translate(0," + 451 + ")")
            .call(xAxis);

          svg.append("g").call(yAxis);

          // Create the scatter plot points
          svg.selectAll("circle").remove(); // Remove existing circles

          var circles = svg
            .selectAll("circle")
            .data(filteredData)
            .enter()
            .append("circle")
            .attr("cx", function (d) {
              return xScale(+d.price);
            })
            .attr("cy", function (d) {
              return yScale(+d.points);
            })
            .attr("r", 2) // Adjust the radius as needed
            .attr("fill", "red"); // Change the point color

          // Add labels for the points (hidden by default)
          // Add labels for the points
          labels = svg
            .selectAll("text")
            .data(filteredData)
            .enter()
            .append("text")
            .text(function (d) {
              return d.variety;
            })
            .attr("x", function (d) {
              return xScale(+d.price) + 10;
            }) // Adjust the label position
            .attr("y", function (d) {
              return yScale(+d.points);
            })
            .attr("font-size", "12px")
            .attr("fill", "black"); // Change the label color
          labels.style("display", "none");
          //labels.style("display", "block")

          // Show labels on mouseover
          circles.on("mouseover", function (d, i) {
            console.log("Hi");
            // Hide all labels first

            var label = labels.filter(function (data) {
              //console.log("data",data)
              //console.log("d",d)
              return data === i;
            });
            console.log("sqwd", label);
            console.log(label.style("display", "block")); // Show the label
          });

          // Hide labels on mouseout
          circles.on("mouseout", function () {
            labels.style("display", "none"); // Hide all labels
          });
        }

        // Event listener for the province selection dropdown
        provinceSelector.addEventListener("change", function () {
          var selectedProvince = provinceSelector.value;
          updateScatterPlot(selectedProvince);
        });

        // Initial scatter plot with all provinces
        updateScatterPlot("All");
      });
    </script>
  </body>
</html>
